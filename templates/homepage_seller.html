<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="../static/css/homepage_seller.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AngkatAni - Homepage Seller</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/homepage_buyer.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <body>
 
    <!-- Header -->
    <header class="top-bar">
      <div class="logo">
          <img src="static/images/logo.png" alt="Agrimart Logo" class="logo-icon">
          AngkatAni
      </div>          
      <div class="tagline">
        Connecting you to Local Farmers
      </div>
    </header>
 
        <!-- Breadcrumb Navigation -->
  <nav class="main-nav">
    <ul class="breadcrumb">
      <li><a href="/homepage_seller"> <i class="fas fa-home"></i></a></li>
      <li>â€º</li>   
    </ul>
   
    <div class="icons">
        <div class="user-dropdown" id="userDropdown">
            <span class="user" id="userIcon"><i class="fas fa-user"></i></span>
            <div class="user-menu" id="userMenu">
              <a href="{{ url_for('seller_account.seller_account') }}" class="account-btn">My Account</a>
              <form action="{{ url_for('homepage_seller.logout') }}" method="post">
                <button class="logout-btn" type="submit">Logout</button>
              </form>
            </div>
          </div>
        </div>
      </nav>

   <aside class="sidenav">
    <div class="status">
      <h3>SELLER MENU</h3>
      <ul class="status-list">
        <li>
          <form action="/homepage_seller" method="get">
           <button type="submit" class="status-item active">
    <i class="fas fa-home"></i> Homepage
</button>
          </form>
        </li>
        <li>
          <form action="{{ url_for('seller_orders.unpaid_orders') }}" method="get">
            <button type="submit" class="status-item"><i class="fas fa-receipt"></i> Orders</button>
          </form>
        </li>
        <li>
          <button type="button" class="status-item" id="addProductBtn"><i class="fas fa-plus-circle"></i> Add Product</button>
        </li>
        <li>
          <form action="/dashboard" method="get">
            <button type="submit" class="status-item"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
          </form>
        </li>
      </ul>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <!-- Top stats -->
    <div class="top-content-container">
      <h2>Welcome, {{ username }}!</h2>
      <p>You have {{ total_products }} products. Monitor the stock of each product variation here.</p>
      <div class="stats-container">
        <div class="stat-box low-stock">
          <h4>LOW STOCK</h4>
          <h2>{{ low_stock_count }}</h2>
          <p>Products running low</p>
        </div>
        <div class="stat-box in-stock">
          <h4>IN STOCK</h4>
          <h2>{{ in_stock_count }}</h2>
          <p>Products ready for buyers</p>
        </div>
        <div class="stat-box restock">
          <h4>RESTOCK</h4>
          <h2>{{ restock_count }}</h2>
          <p>Products out of stock</p>
        </div>
      </div>
    </div>

    <!-- Product Grid -->
    <div class="column-right">
      <div class="product-container">
        {% for product in products %}
          <div class="product-box">
            <div class="image-container">
              <a href="{{ url_for('homepage_seller.edit_product', product_id=product['ProductID']) }}">
                <img src="{{ url_for('static', filename='images/products/' + product['ImageFilename']) }}" alt="Product Image">
              </a>
            </div>
            <div class="product-details">
              <p class="product-name">{{ product['Product_Name'] }}</p>
            </div>
            <div class="variation-container">
              {% for variation in product['variations'] %}
                <span class="variation-unit 
                  {% if variation['Status'] == 'in-stock' %}in-stock
                  {% elif variation['Status'] == 'low-stock' %}low-stock
                  {% else %}restock{% endif %}">
                  {{ variation['Unit'] }}
                </span>
              {% endfor %}
            </div>
            <div class="button-container">
              <form action="{{ url_for('homepage_seller.edit_product', product_id=product['ProductID']) }}" method="get">
                <button type="submit" class="edit-button">Edit</button>
              </form>
              <form action="{{ url_for('homepage_seller.delete_product', product_id=product['ProductID']) }}" method="post">
                <button type="submit" class="delete-button">Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
 
 
  <!-- JavaScript -->
  <script>
    document.querySelectorAll('.category-option input[type="radio"]').forEach(radio => {
      radio.addEventListener('change', function () {
        this.closest('form').submit();
      });
    });

    document.addEventListener('DOMContentLoaded', function () {
      const userIcon = document.getElementById('userIcon');
      const userMenu = document.getElementById('userMenu');
  
      userIcon.addEventListener('click', function (event) {
        userMenu.classList.toggle('show');
        event.stopPropagation(); 
      });
  
      // Close the dropdown if clicked outside
      document.addEventListener('click', function (event) {
        if (!userMenu.contains(event.target)) {
          userMenu.classList.remove('show');
        }
      });
    });

     document.getElementById("addProductBtn").addEventListener("click", function () {
    fetch("/check_payment_options")
        .then(response => response.json())
        .then(data => {
            if (data.hasPayment) {
                window.location.href = "/add_product";
            } else {
                Swal.fire({
                    icon: 'warning',
                    title: 'Set Payment Options First',
                    text: 'Before adding a product, please set your payment options.',
                    confirmButtonText: 'Go to Payment Options'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = "/payment_options"; 
                    }
                });
            }
        });
});
    </script>
  </body>
</html>