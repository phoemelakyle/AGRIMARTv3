<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AngkatAni - Orders</title>
    <link rel="stylesheet" type="text/css" href="../static/css/buyer_order.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/homepage_buyer.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="top-bar">
    <div class="logo">
      <img src="static/images/logo.png" alt="Agrimart Logo" class="logo-icon" />
      AngkatAni
    </div>
    <div class="tagline">Connecting you to Local Farmers</div>
  </header>
  
  <!-- Breadcrumb Navigation -->
  <nav class="main-nav">
    <ul class="breadcrumb">
      <li><a href="/homepage_buyer"><i class="fas fa-home"></i></a></li>
      <li>›</li>
      <li><a href="/to-pay-orders" class="button">Orders</a></li>
    </ul>
    <div class="icons">
      <span class="cart">
        <a href="{{ url_for('cart.cart') }}" class="cart-link">
          <i class="fas fa-shopping-cart"></i>
        </a>
      </span>
      <div class="user-dropdown" id="userDropdown">
        <span class="user" id="userIcon"><i class="fas fa-user"></i></span>
        <div class="user-menu" id="userMenu">
          <form action="{{ url_for('homepage_buyer.logout') }}" method="post">
            <button class="logout-btn" type="submit">Logout</button>
          </form>
        </div>
      </div>
    </div>
  </nav>
   
  <!-- Main Layout -->
<aside class="sidenav">     
      <!-- Buyer Menu -->
      <div class="status">
        <h3>BUYER MENU</h3>
        <ul class="status-list">
          <li>
            <form action="/homepage_buyer" method="get">
              <button type="submit" class="status-item"><i class="fas fa-home"></i> Homepage</button>
            </form>
          </li>
          <li>
            <form action="{{ url_for('homepage_buyer.to_pay_orders') }}" method="get">
              <button type="submit" class="status-item active">
                <i class="fas fa-receipt"></i> Orders
              </button>
            </form>
          </li>
        </ul>
      </div>
    </aside>

     <div class="main-content">
    <div class="column-right">
      <div class="status-container">
        <h3>STATUS</h3>
        <div class="status-tracker">
          {% for status, icon in [('to_pay', 'wallet'), ('to_ship', 'box'), ('shipping', 'truck'), ('delivered', 'check-circle'), ('cancelled', 'times-circle')] %}
          <form action="{{ url_for('homepage_buyer.' + status + '_orders') }}" method="get" class="step">
            <button type="submit" class="circle {% if order_type == status %}active-status{% endif %}">
              <i class="fas fa-{{ icon }}"></i>
            </button>
            <p>{{ status.replace('_', ' ').title() }}</p>
          </form>
          {% endfor %}
        </div>
      </div>
  
      <!-- Order Details Section -->
      <div class="product-info">
        <div class="section-header">
          <h1>ORDER DETAILS</h1>
          <form method="get" action="{{ url_for('homepage_buyer.' + order_type + '_orders') }}" class="sort-form">
            <label for="sort">Sort by:</label>
            <select name="sort" id="sort" onchange="this.form.submit()">
              <option value="recent" {% if request.args.get('sort') == 'recent' %}selected{% endif %}>Recent</option>
              <option value="old" {% if request.args.get('sort') == 'old' %}selected{% endif %}>Old</option>
            </select>
          </form>
        </div>
  
        {% if order_details %}
        <!-- Card Grid Layout -->
          <div class="orders-grid">
            {% for order_detail in order_details %}
            <div class="order-card">
                <!-- Main Content -->
                <div class="card-content">
                  <!-- Header Section -->
                  <div class="card-header">
                    <div>
                      <p class="order-date"><i class="fas fa-calendar"></i> {{ order_detail['Order_Date'] }}</p>
                    </div>
                    <span class="status-badge {% if order_type == 'to_pay' %}to-pay{% elif order_type == 'to_ship' %}to-ship{% elif order_type == 'shipping' %}shipping{% elif order_type == 'delivered' %}completed{% elif order_type == 'cancelled' %}cancelled{% endif %}">
                    {% if order_type == 'to_pay' %}
                    To Pay
                    {% elif order_type == 'to_ship' %}
                    To Ship
                    {% elif order_type == 'shipping' %}
                    Shipping
                    {% elif order_type == 'delivered' %}
                    Delivered
                    {% elif order_type == 'cancelled' %}
                    Cancelled
                    {% endif %}
                    </span>
                  </div>

                  <div class="card-body-layout">
                    <div class="left-side">
                      <div class="details-section">
                        <!-- Product Image -->
                        <div class="product-image">
                          <img src="{{ url_for('static', filename='images/products/' + order_detail['ImageFileName']) }}" 
                              alt="{{ order_detail['Product_Name'] }}" width="120" height="120">
                        </div>

                        <!-- Product Details -->
                        <div class="product-details">
                          <h3 class="product-name">{{ order_detail['Product_Name'] }}</h3>
                          <p><span class="label">Quantity:</span> <span class="value">{{ order_detail['Quantity'] }}</span></p>
                          <p><span class="label">Variation:</span> <span class="value">{{ order_detail['Unit'] }}</span></p>
                          <p><span class="label">Unit Price:</span> <span class="value">P{{ order_detail['Price'] }}</span></p>
                          <p><span class="label">Shipping Fee:</span> <span class="value">P{{ order_detail['Shipping_Fee'] }}</span></p>
                        </div>
                      </div>

                      <!-- Buyer Address -->
                      <div class="buyer-section">
                        <h5><i class="fas fa-map-marker-alt"></i> Delivery Address</h5>
                        <p>{{ order_detail['Buyer_Address'] }}</p>
                      </div>

                      <!-- Payment Method -->
                      <div class="buyer-section">
                        <h5><i class="fas fa-money-bill-wave"></i> Payment Method</h5>
                        <p>{{ order_detail['Payment_Option'] }}</p>
                      </div>
                    </div>

                    <!-- Total & Actions -->
                    <div class="right-side">
                      <div class="total-section-box">
                          <h5>Order Summary</h5>

                          <div class="total-row">
                              <span>Subtotal</span>
                              <span style="color: black;">₱{{ order_detail['Price'] * order_detail['Quantity'] }}</span>
                          </div>

                          <div class="total-row">
                              <span>Total Shipping Fee</span>
                              <span style="color: black;">₱{{ order_detail['Shipping_Fee'] * order_detail['Quantity'] }}</span>
                          </div>

                          <div class="total-row total-row-final">
                              <span>Total</span>
                              <span class="total-amount">₱{{ order_detail['Total_Amount'] }}</span>
                          </div>
                      </div>

                      <!-- ACTION BUTTONS (unchanged) -->
                      <div class="action-buttons">
                        {% if order_type == 'to_pay' %}
                        <form action="{{ url_for('homepage_buyer.pay_now', order_id=order_detail['OrderID']) }}" method="post" class="action-form">
                          <button type="submit" class="btn btn-primary">Pay Now</button>
                        </form>
                        <form action="{{ url_for('homepage_buyer.cancel_to_pay', order_id=order_detail['OrderID']) }}" method="post" class="action-form">
                          <button type="submit" class="btn btn-secondary">Cancel Order</button>
                        </form>
                        {% elif order_type == 'to_ship' %}
                        <form action="{{ url_for('homepage_buyer.cancel_to_ship', order_id=order_detail['OrderID']) }}" method="post" class="action-form">
                          <button type="submit" class="btn btn-secondary">Cancel Order</button>
                        </form>
                        {% elif order_type == 'shipping' %}
                        <form action="{{ url_for('homepage_buyer.order_received', order_id=order_detail['OrderID']) }}" method="post" class="action-form">
                          <button type="submit" class="btn btn-primary">Order Received</button>
                        </form>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="no-orders-msg">No orders yet. Place an order now!</p>
        {% endif %}
      </div>
    </div>
  </div>
         
 
  <!-- Scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const userIcon = document.getElementById('userIcon');
      const userMenu = document.getElementById('userMenu');
 
      userIcon.addEventListener('click', function (event) {
        userMenu.classList.toggle('show');
        event.stopPropagation();
      });
 
      document.addEventListener('click', function (event) {
        if (!userMenu.contains(event.target)) {
          userMenu.classList.remove('show');
        }
      });
 
      const refreshPageValue = "{{ refresh_page }}";
  if (refreshPageValue === 'True' && !sessionStorage.getItem('hasReloaded')) {
    sessionStorage.setItem('hasReloaded', 'true');
    window.location.reload();
  } else {
    sessionStorage.removeItem('hasReloaded');
  }
    });
  </script>


      <!-- Reload Script -->
      <script>
        console.log('Script loaded');
        (function () {
          var refreshPageValue = "{{ refresh_page }}";
          if (refreshPageValue === 'True' && !sessionStorage.hasReloaded) {
            console.log('Reloading page...');
            window.location.reload();
            sessionStorage.hasReloaded = true;
          } else {
            sessionStorage.removeItem('hasReloaded');
          }
        })();
      </script>
     
     
    </body>
    </html>
